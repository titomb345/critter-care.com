---
import '../styles/global.css';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import settings from '../content/settings.json';
import { testimonials } from '../content/testimonials.json';
import { services } from '../content/services.json';

interface Props {
  title: string;
  description?: string;
  noindex?: boolean;
}

const { title, description = 'Professional pet sitting and boarding services in Lawndale, CA and the South Bay area. Trusted care since 1999.', noindex = false } = Astro.props;
const t = settings.theme;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const ogImage = new URL('/images/pets/dogs-in-yard.jpg', Astro.site);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}
    <link rel="canonical" href={canonicalURL.href} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Critter Care" />
    <meta property="og:url" content={canonicalURL.href} />
    <meta property="og:image" content={ogImage.href} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage.href} />
    <meta name="geo.region" content="US-CA" />
    <meta name="geo.placename" content="Lawndale" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Critter-Care" />
    <link rel="manifest" href="/site.webmanifest" />
    <title>{title}</title>
    <script is:inline src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "Critter Care",
      "description": "Professional pet sitting, dog walking, and boarding services in Lawndale, CA and the South Bay area. Trusted care since 1999.",
      "url": "https://www.critter-care.com",
      "foundingDate": "1999",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Lawndale",
        "addressRegion": "CA",
        "addressCountry": "US"
      },
      "areaServed": {
        "@type": "GeoCircle",
        "geoMidpoint": {
          "@type": "GeoCoordinates",
          "latitude": 33.8872,
          "longitude": -118.3526
        },
        "geoRadius": "15mi"
      },
      "sameAs": [
        "https://www.facebook.com/laurieb1"
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Pet Care Services",
        "itemListElement": services.map(s => ({
          "@type": "Offer",
          "itemOffered": { "@type": "Service", "name": s.name }
        }))
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "reviewCount": String(testimonials.length)
      }
    })} />
    {t && (
      <style set:html={`:root {
        --color-primary: ${t.primary};
        --color-primary-light: ${t.primaryLight};
        --color-primary-dark: ${t.primaryDark};
        --color-primary-soft: ${t.primarySoft};
        --color-base: ${t.base};
        --color-surface: ${t.surface};
        --color-surface-alt: ${t.surfaceAlt};
        --color-foreground: ${t.foreground};
        --color-heading: ${t.heading};
        --color-muted: ${t.muted};
        --color-border: ${t.border};
      }`} />
    )}
  </head>
  <body class="min-h-screen flex flex-col bg-base text-foreground">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-[999] focus:px-4 focus:py-2 focus:bg-primary focus:text-white focus:rounded-lg">
      Skip to main content
    </a>
    <Navbar />
    <main id="main-content" class="flex-1">
      <slot />
    </main>
    <Footer />
    <script is:inline>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
  </body>
</html>
